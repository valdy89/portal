<div cg-busy="[ctrl.subtenants]">
</div>

<md-content class="md-padding">
  <div layout="row">
    <md-card flex>
      <md-card-title>
        <md-card-title-text>
          <span class="md-headline">Subtenanti</span>
        </md-card-title-text>
        <md-card-actions  layout="row" layout-xs="column" layout-align="end center" layout-wrap>
          <md-button ng-click="ctrl.createSubtenant()" class="md-raised md-accent md-fab md-mini" title="Založit subtenant"><md-icon md-font-icon="fa-plus" class="fa fa-1-5"></md-icon></md-button><span flex="5">
        </md-card-actions>

      </md-card-title>


      <md-card-content>
        <table md-table>
          <thead md-head>
            <tr md-row>
              <th md-column>Jméno</th>
              <th md-column>Alokace GB</th>
              <th md-column>Využívaná GB</th>
              <th md-column>Využívaná %</th>
              <th md-column>Povolen</th>
              <th md-column>Založen</th>
              <th md-column></th>
            </tr>
          </thead>
          <tbody md-body>
            <tr md-row ng-repeat="subtenant in ctrl.subtenants">
              <td md-cell>{{::subtenant.username}}</td>
              <td md-cell>{{::subtenant.quota/1024 | number:1}}</td>
              <td md-cell>{{::subtenant.usedQuota/1024 | number:1}}</td>
              <td md-cell>{{::(subtenant.usedQuota/subtenant.quota)*100 | number:2}}%</td>
              <td md-cell >
                <span class="fa fa-check" style="color: green" ng-if="subtenant.enabled"></span>
                <span class="fa fa-remove red" style="color: red" ng-if="!subtenant.enabled"></span>
              </td>
              <td md-cell>{{::subtenant.dateCreated | portalDateTime}}</td>
              <td md-cell layout="row" layout-align="end center" flex>
                <md-button type="button" class="md-primary md-icon-button launch" ng-click="ctrl.updateSubtenant(subtenant)" title="upravit">
                  <md-icon md-font-icon="fa-pencil-square-o" class="fa fa-2" ></md-icon>
                </md-button>
                <md-button type="button" class="md-warn md-icon-button launch" ng-click="ctrl.deleteSubtenant(subtenant)" title="smazat">
                  <md-icon md-font-icon="fa-trash" class="fa fa-2"></md-icon>
                </md-button>

              </td>
            </tr>
          </tbody>
        </table>
      </md-card-content>
    </md-card>
  </div>
</md-content>

<script type="text/ng-template" id="createSubtenant.html">
  <div cg-busy="[ctrl.promise]"></div>

  <md-dialog flex-gt-sm="40" flex>
    <md-toolbar class="md-accent">
      <h2 class="md-toolbar-tools">
      Založit subtenant
      </h2>
    </md-toolbar>

    <md-dialog-content>
      <div class="md-dialog-content">
        <form name="ctrl.createSubtenantForm" role="form">
          <md-input-container class="md-block form-group">
            <label>Název</label>
            <input type="text" ng-model="ctrl.subtenant.username" class="form-control" required="true">

          </md-input-container>
          <md-input-container class="md-block form-group">
            <label>Velikost kvóty v GB: </label>
            <input type="number" ng-model="ctrl.quota" class="form-control" required="true" min="0">

          </md-input-container>
          <md-input-container class="md-block form-group">
            <label>Heslo:</label>
            <input type="password" ng-model="ctrl.subtenant.password" class="form-control" required="true">

          </md-input-container>
          <md-input-container class="md-block form-group">
            <label>Heslo znovu:</label>
            <input type="password" ng-model="ctrl.subtenant.confirmPassword" class="form-control" required="true">

          </md-input-container>
          <md-input-container class="md-block form-group">
            <md-switch class="md-accent" name="special" ng-model="ctrl.subtenant.enabled">
              Subtenant <span ng-if="ctrl.subtenant.enabled">povolen</span><span ng-if="!ctrl.subtenant.enabled">nepovolen</span>
            </md-switch>
          </md-input-container>
        </form>
      </div>
    </md-dialog-content>


    <md-dialog-actions layout="row" layout-xs="column" layout-align="center center">
      <div class="modal-footer">
        <md-button type="button" class="md-raised md-accent" ng-disabled="ctrl.subtenant.password !== ctrl.subtenant.confirmPassword ||!ctrl.createSubtenantForm.$valid" ng-click="ctrl.save()">Založit</md-button>
        <md-button type="button" class="md-raised" ng-click="ctrl.cancel()">Zavřít</md-button>
      </div>
    </md-dialog-actions>
  </md-dialog>
</script>

<script type="text/ng-template" id="updateSubtenant.html">
  <div cg-busy="[ctrl.promise]"></div>

  <md-dialog flex-gt-sm="40" flex>
    <md-toolbar class="md-accent">
      <h2 class="md-toolbar-tools">
      Upravit subtenant {{ctrl.subtenant.username}}
      </h2>
    </md-toolbar>

    <md-dialog-content>
      <div class="md-dialog-content">
        <form name="ctrl.updateSubtenantForm" role="form">
          <md-input-container class="md-block form-group">
            <label>Velikost kvóty v GB: </label>
            <input type="number" ng-model="ctrl.quota" class="form-control" min="0">

          </md-input-container>
          <md-input-container class="md-block form-group">
            <label>Heslo:</label>
            <input type="password" ng-model="ctrl.subtenant.password" class="form-control">

          </md-input-container>
          <md-input-container class="md-block form-group">
            <label>Heslo znovu:</label>
            <input type="password" ng-model="ctrl.subtenant.confirmPassword" class="form-control">

          </md-input-container>
          <md-input-container class="md-block form-group">
            <md-switch class="md-accent" name="special" ng-model="ctrl.subtenant.enabled">
              Subtenant <span ng-if="ctrl.subtenant.enabled">povolen</span><span ng-if="!ctrl.subtenant.enabled">nepovolen</span>
            </md-switch>
          </md-input-container>
        </form>
      </div>
    </md-dialog-content>

    <md-dialog-actions layout="row" layout-xs="column" layout-align="center center">
      <div class="modal-footer">
        <md-button type="button" class="md-raised md-accent" ng-disabled="(ctrl.subtenant.password !== ctrl.subtenant.confirmPassword && ctrl.subtenant.password) ||!ctrl.updateSubtenantForm.$valid" ng-click="ctrl.update()">Upravit</md-button>
        <md-button type="button" class="md-raised" ng-click="ctrl.cancel()">Zavřít</md-button>
      </div>
    </md-dialog-actions>
  </md-dialog>
</script>



<script type="text/ng-template" id="deleteSubtenant.html">
  <div cg-busy="[ctrl.promise]"></div>

  <md-dialog>
    <md-toolbar class="md-accent">
      <h2 class="md-toolbar-tools">
      Smazat subtenant {{ctrl.subtenant.username}}
      </h2>
    </md-toolbar>

    <md-dialog-content>
      <div class="md-dialog-content">
        Opravdu si přejete smazat subtenant {{ctrl.subtenant.username}}?
      </div>
    </md-dialog-content>

    <md-dialog-actions layout="row" layout-xs="column" layout-align="center center">
      <div class="modal-footer">
        <md-button type="button" class="md-raised md-accent" ng-click="ctrl.delete()">Ano</md-button>
        <md-button type="button" class="md-raised" ng-click="ctrl.cancel()">Ne</md-button>
      </div>
    </md-dialog-actions>
  </md-dialog>
</script>
